<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quem sou eu — Resultado</title>

  <style>
    :root{
      --bg:#f3f5f8;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --shadow:0 12px 34px rgba(15,23,42,.10);
      --accent:#f07a00;
      --accent2:#0b2a5b;
      --soft:#fff6ee;
      --softBorder:rgba(240,122,0,.35);
    }
    *{ box-sizing:border-box }
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 40px;
    }

    .header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom:14px;
    }
    .title h1{
      margin:0;
      font-size:44px;
      letter-spacing:-.5px;
    }
    .title p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
    }

    .gridTop{
      display:grid;
      grid-template-columns: 1.5fr .9fr;
      gap:16px;
      align-items:start;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:18px;
    }

    .card h2{
      margin:0 0 8px;
      font-size:18px;
    }

    .topList{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:12px;
    }

    .topItem{
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      background:#fff;
    }

    .topItem .left{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .rankLine{
      font-weight:900;
      font-size:16px;
      color:#0b2a5b;
    }

    .typeName{
      font-weight:800;
      font-size:13px;
      color:#0f172a;
    }

    .desc{
      font-size:13px;
      color:#475569;
      line-height:1.35;
      max-width:520px;
    }

    .score{
      font-weight:900;
      font-size:22px;
      color:#0f172a;
      min-width:50px;
      text-align:right;
    }

    .actionsCard{
      background:var(--soft);
      border:1px solid var(--softBorder);
      border-radius:18px;
      padding:18px;
      box-shadow:var(--shadow);
    }

    .actionsCard h2{
      margin:0 0 6px;
      font-size:18px;
    }

    .actionsCard p{
      margin:0 0 12px;
      color:#475569;
      font-size:13px;
      line-height:1.35;
    }

    .btnRow{
      display:flex;
      gap:10px;
      margin:10px 0 14px;
      flex-wrap:wrap;
    }

    .btn{
      padding:12px 14px;
      border-radius:14px;
      font-weight:900;
      border:0;
      cursor:pointer;
      font-size:13px;
    }
    .btnOutline{
      background:#fff;
      border:1px solid var(--border);
      color:#0f172a;
    }
    .btnPrimary{
      background:var(--accent);
      color:#fff;
      flex:1;
      min-width:160px;
    }
    .btnPrimary:hover{ filter:brightness(.98) }

    .divider{
      height:1px;
      background:rgba(15,23,42,.12);
      margin:14px 0;
    }

    .smallTitle{
      font-weight:900;
      margin:0 0 6px;
      color:#0f172a;
    }

    .quick{
      font-size:13px;
      color:#334155;
      line-height:1.35;
    }

    /* section below */
    .section{
      margin-top:16px;
    }
    .section h3{
      margin:0 0 8px;
      font-size:20px;
      letter-spacing:-.2px;
    }
    .section p{
      margin:0;
      color:#334155;
      font-size:14px;
      line-height:1.45;
    }

    .gridBottom{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
      margin-top:14px;
    }

    .listBox{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:16px;
    }
    .listBox h4{
      margin:0 0 10px;
      font-size:16px;
      font-weight:900;
      color:#0f172a;
    }
    ul{
      margin:0;
      padding-left:18px;
      color:#0f172a;
      font-size:14px;
      line-height:1.6;
    }
    li{ margin:4px 0; }

    /* errors */
    .error{
      display:none;
      background:#fff7f7;
      border:1px solid rgba(220,38,38,.25);
      color:#b91c1c;
      border-radius:14px;
      padding:12px;
      margin-top:12px;
      font-size:13px;
      line-height:1.35;
    }

    /* responsive */
    @media (max-width: 900px){
      .title h1{ font-size:36px; }
      .gridTop{ grid-template-columns: 1fr; }
      .score{ font-size:20px; }
    }
    @media (max-width: 520px){
      .title h1{ font-size:30px; }
      .topItem{ padding:12px; }
      .desc{ font-size:12.5px; }
      .gridBottom{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <h1>Quem sou eu</h1>
        <p>Abaixo está o seu resultado com base nas respostas do formulário.</p>
      </div>
    </div>

    <div class="gridTop">
      <!-- LEFT: TOP 3 -->
      <div class="card">
        <h2>Sua tríade principal (Top 3)</h2>
        <div style="color:var(--muted); font-size:13px;">Os 3 tipos mais altos (ordem decrescente).</div>

        <div id="topList" class="topList"></div>

        <div id="errBox" class="error"></div>
      </div>

      <!-- RIGHT: ACTIONS + QUICK SUMMARY -->
      <div class="actionsCard">
        <h2>Ações</h2>
        <p>Você pode voltar, ou refazer o teste do zero.</p>

        <div class="btnRow">
          <button class="btn btnOutline" id="btnVoltar">Voltar</button>
          <button class="btn btnPrimary" id="btnRefazer">Refazer teste</button>
        </div>

        <div class="divider"></div>

        <div class="smallTitle">Resumo rápido</div>
        <div class="quick" id="quickResumo">Carregando…</div>
      </div>
    </div>

    <!-- How you function -->
    <div class="section">
      <h3>Como você tende a funcionar</h3>
      <p id="comoFunciona">Carregando…</p>
    </div>

    <!-- Strengths / Improvements -->
    <div class="gridBottom">
      <div class="listBox">
        <h4>Pontos fortes (da tríade)</h4>
        <ul id="listaFortes"></ul>
      </div>

      <div class="listBox">
        <h4>Pontos a melhorar (da tríade)</h4>
        <ul id="listaMelhorar"></ul>
      </div>
    </div>
  </div>

<script>
  // ====== CONFIG / KEYS ======
  const RESPOSTAS_KEY = "respostas";                 // onde você já salva tudo
  const LEAD_KEY = "atrius_eneagrama_lead_v1";       // cadastro do index
  const MATRIZ_URL = "/data/matriz.json";            // pela sua estrutura

  // ====== TEXTOS DOS TIPOS ======
  const TIPOS = {
    1: { nome: "Perfeccionista / Reformador",  curta: "Busca fazer o correto, melhorar padrões e evitar erros." },
    2: { nome: "Prestativo / Cuidador",        curta: "Busca ajudar, ser necessário e criar conexão com pessoas." },
    3: { nome: "Realizador",                  curta: "Busca alcançar resultados, ser reconhecido e vencer desafios." },
    4: { nome: "Individualista",              curta: "Busca autenticidade, profundidade e identidade própria." },
    5: { nome: "Investigador",                curta: "Busca compreender, dominar assuntos e preservar energia." },
    6: { nome: "Leal",                         curta: "Busca segurança, previsibilidade e confiança." },
    7: { nome: "Entusiasta",                  curta: "Busca opções, liberdade, experiências e leveza." },
    8: { nome: "Desafiador",                  curta: "Busca autonomia, força e proteção do seu território." },
    9: { nome: "Pacificador",                 curta: "Busca harmonia, estabilidade e evitar conflitos." }
  };

  // ====== LISTAS POR TRÍADE (top3 string "3-1-6") ======
  // (você pode ir ajustando depois, mas já fica bem “profissional”)
  const TRIADE_MAP = {
    "3-1-6": {
      resumo: "Tipo 3 aparece como o mais provável, com influência de Tipo 1 e Tipo 6.",
      funciona: "Sua tríade principal é 3-1-6. Você combina o Realizador (dominante) com influências de Tipo 1 e Tipo 6. Isso costuma gerar um estilo de funcionar com foco em resultado e execução, apoiado por padrão e correção e segurança e lealdade.",
      fortes: [
        "Foco, velocidade e entrega",
        "Orientação a metas e performance",
        "Qualidade, capricho e responsabilidade",
        "Consistência e melhoria contínua",
        "Confiabilidade e comprometimento com o time",
        "Antecipação de riscos e responsabilidade"
      ],
      melhorar: [
        "Pressa e ansiedade por resultado",
        "Confundir valor pessoal com desempenho",
        "Autocrítica e rigidez",
        "Dificuldade em aceitar erro/imperfeição",
        "Ansiedade e dúvida excessiva",
        "Necessidade de garantias o tempo todo"
      ]
    }
  };

  // fallback genérico (se der uma tríade diferente)
  function buildGenericTriade(top3){
    const t1 = Number(top3[0]?.t);
    const t2 = Number(top3[1]?.t);
    const t3 = Number(top3[2]?.t);
    const chave = `${t1}-${t2}-${t3}`;

    return {
      resumo: `Tipo ${t1} aparece como o mais provável, com influência de Tipo ${t2} e Tipo ${t3}.`,
      funciona: `Sua tríade principal é ${chave}. Você combina o Tipo ${t1} (dominante) com influências de Tipo ${t2} e Tipo ${t3}.`,
      fortes: [
        "Clareza sobre objetivos",
        "Capacidade de adaptação em cenários diferentes",
        "Busca de evolução e aprendizado",
        "Compromisso com entregas e relações"
      ],
      melhorar: [
        "Excesso de cobrança e comparação",
        "Oscilar entre velocidade e ansiedade",
        "Tendência a evitar desconfortos importantes",
        "Necessidade de validação/segurança em excesso"
      ]
    };
  }

  // ====== HELPERS ======
  function getLocalJSON(key){
    try{ return JSON.parse(localStorage.getItem(key) || "null"); }
    catch{ return null; }
  }

  function showError(msg){
    const el = document.getElementById("errBox");
    el.style.display = "block";
    el.textContent = msg;
  }

  async function loadMatriz(){
    const res = await fetch(MATRIZ_URL, { cache: "no-store" });
    if(!res.ok) throw new Error("Não consegui carregar /data/matriz.json. Verifique se o arquivo existe na pasta /data.");
    return res.json();
  }

  function computeScore(respostas, matriz){
    const score = {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
    respostas.forEach(r=>{
      const key = `${r.pergunta}_${r.alternativa}`;
      const w = matriz[key];
      if(!w) return;
      for(const t in w) score[t] += w[t];
    });
    return score;
  }

  function top3FromScore(score){
    return Object.entries(score)
      .map(([t,v])=>({ t:Number(t), v:Number(v) }))
      .sort((a,b)=>b.v-a.v)
      .slice(0,3);
  }

  function renderTop3(top3){
    const list = document.getElementById("topList");
    list.innerHTML = top3.map((it, idx)=>{
      const tipo = TIPOS[it.t];
      const rank = (idx+1) + "º — Tipo " + it.t;
      return `
        <div class="topItem">
          <div class="left">
            <div class="rankLine">${rank}</div>
            <div class="typeName">${tipo?.nome || ""}</div>
            <div class="desc">${tipo?.curta || ""}</div>
          </div>
          <div class="score">${it.v}</div>
        </div>
      `;
    }).join("");
  }

  function renderTriadeTexts(top3){
    const chave = `${top3[0].t}-${top3[1].t}-${top3[2].t}`;
    const data = TRIADE_MAP[chave] || buildGenericTriade(top3);

    document.getElementById("quickResumo").textContent = data.resumo;

    // texto “Como funciona” com negrito nos pontos-chave
    const t1 = top3[0].t, t2 = top3[1].t, t3 = top3[2].t;
    const n1 = TIPOS[t1]?.nome?.split(" / ")[0] || `Tipo ${t1}`;
    const n2 = `Tipo ${t2}`;
    const n3 = `Tipo ${t3}`;

    document.getElementById("comoFunciona").innerHTML =
      `Sua tríade principal é <b>${t1}-${t2}-${t3}</b>. Você combina o <b>${n1}</b> (dominante) com influências de <b>${n2}</b> e <b>${n3}</b>. ${data.funciona.replace(/^Sua tríade principal.*?\.\s*/,'')}`;

    const ulF = document.getElementById("listaFortes");
    ulF.innerHTML = data.fortes.map(x=>`<li>${x}</li>`).join("");

    const ulM = document.getElementById("listaMelhorar");
    ulM.innerHTML = data.melhorar.map(x=>`<li>${x}</li>`).join("");
  }

  // ====== NAV ======
  document.getElementById("btnVoltar").addEventListener("click", ()=>{
    window.location.href = "/pages/page4";
  });

  document.getElementById("btnRefazer").addEventListener("click", ()=>{
    // se quiser limpar tudo:
    // localStorage.removeItem(RESPOSTAS_KEY);
    // localStorage.removeItem(LEAD_KEY);
    window.location.href = "/";
  });

  // ====== INIT ======
  (async function init(){
    try{
      const respostas = getLocalJSON(RESPOSTAS_KEY) || [];
      if(!Array.isArray(respostas) || respostas.length === 0){
        showError("Não encontrei respostas salvas. Volte e finalize o teste novamente.");
        document.getElementById("quickResumo").textContent = "Sem dados.";
        document.getElementById("comoFunciona").textContent = "Sem dados.";
        return;
      }

      const matriz = await loadMatriz();
      const score = computeScore(respostas, matriz);
      const top3 = top3FromScore(score);

      renderTop3(top3);
      renderTriadeTexts(top3);
    }catch(err){
      console.error(err);
      showError(err?.message || String(err));
      document.getElementById("quickResumo").textContent = "Erro ao carregar.";
      document.getElementById("comoFunciona").textContent = "Erro ao carregar.";
    }
  })();
</script>
</body>
</html>
