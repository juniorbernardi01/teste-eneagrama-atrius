<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quem sou eu — Passo 4</title>

<style>
:root{
  --accent:#f07a00;
  --accent-weak: rgba(240,122,0,.12);
  --accent-border: rgba(240,122,0,.45);
  --bg:#f6f7fb;
  --card:#ffffff;
  --bd:#e7e7e7;
  --text:#111;
  --muted:#666;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:980px;margin:auto;padding:16px;}
.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  box-shadow:0 10px 28px rgba(0,0,0,.06);
}
h1{margin:0 0 6px;font-size:32px;}
.muted{color:var(--muted);font-size:14px;line-height:1.4}

.step{margin:12px 0}
.bar{height:10px;background:#e9e9e9;border-radius:999px;overflow:hidden;margin-top:6px;}
.fill{height:100%;width:100%;background:var(--accent);}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  margin-top:14px;
}
@media(max-width:768px){ .grid{grid-template-columns:1fr;} }

.word{
  border:1px solid var(--bd);
  border-radius:16px;
  padding:14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  cursor:pointer;
  background:#fff;
  transition:all .15s ease;
}
.word.selected{
  background:var(--accent-weak);
  border-color:var(--accent-border);
  box-shadow:0 0 0 3px var(--accent-weak);
}
.word small{color:#888;font-weight:800;min-width:26px}
.word input{transform:scale(1.2)}

.actions{
  display:flex;
  gap:10px;
  margin-top:16px;
}
.btn{
  padding:14px;
  border-radius:14px;
  border:0;
  font-weight:900;
  cursor:pointer;
}
.btn-primary{background:var(--accent);color:#fff;flex:1}
.btn-outline{background:#fff;border:1px solid var(--bd)}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<h1>Quem sou eu</h1>
<p class="muted">Marque apenas as palavras que realmente combinam com você ao longo da vida.</p>

<div class="step">
  <b>Passo 4 de 4 — Identificação pessoal</b>
  <div class="bar"><div class="fill"></div></div>
</div>

<p class="muted"><b>Instruções:</b> selecione pelo menos <b>6 opções</b>.</p>

<form id="formP4">
  <div class="grid" id="gridWords"></div>

  <div class="actions">
    <button type="button" class="btn btn-outline" onclick="history.back()">Voltar</button>
    <button type="button" id="btnFinish" class="btn btn-primary">Ver resultado</button>
  </div>
</form>

</div>
</div>

<script>
/* ================= CONFIG ================= */
const STORAGE_KEY = "respostas";
const MIN = 6;

const LEAD_KEY_MAIN="atrius_eneagrama_lead_v1";
const LEAD_KEY_FALLBACK="lead";

/* ================= PALAVRAS (36 = 4 por tipo) ================= */
const palavras = [
  // Tipo 1
  { label:"Organizado(a)",    type:"1" },
  { label:"Disciplinado(a)",  type:"1" },
  { label:"Detalhista",       type:"1" },
  { label:"Exigente",         type:"1" },

  // Tipo 2
  { label:"Atencioso(a)",     type:"2" },
  { label:"Prestativo(a)",    type:"2" },
  { label:"Acolhedor(a)",     type:"2" },
  { label:"Generoso(a)",      type:"2" },

  // Tipo 3
  { label:"Determinado(a)",   type:"3" },
  { label:"Competitivo(a)",   type:"3" },
  { label:"Focado(a)",        type:"3" },
  { label:"Produtivo(a)",     type:"3" },

  // Tipo 4
  { label:"Autêntico(a)",     type:"4" },
  { label:"Sensível",         type:"4" },
  { label:"Criativo(a)",      type:"4" },
  { label:"Profundo(a)",      type:"4" },

  // Tipo 5
  { label:"Analítico(a)",     type:"5" },
  { label:"Observador(a)",    type:"5" },
  { label:"Reservado(a)",     type:"5" },
  { label:"Investigativo(a)", type:"5" },

  // Tipo 6
  { label:"Leal",             type:"6" },
  { label:"Cauteloso(a)",     type:"6" },
  { label:"Responsável",      type:"6" },
  { label:"Prevenido(a)",     type:"6" },

  // Tipo 7
  { label:"Curioso(a)",       type:"7" },
  { label:"Entusiasmado(a)",  type:"7" },
  { label:"Versátil",         type:"7" },
  { label:"Aventureiro(a)",   type:"7" },

  // Tipo 8
  { label:"Mandão / Mandona", type:"8" },
  { label:"Impositivo(a)",    type:"8" },
  { label:"Dominante",        type:"8" },
  { label:"Protetor(a)",      type:"8" },

  // Tipo 9
  { label:"Tranquilo(a)",     type:"9" },
  { label:"Harmonioso(a)",    type:"9" },
  { label:"Paciente",         type:"9" },
  { label:"Conciliador(a)",   type:"9" },
];

/* ================= HELPERS ================= */
function getList(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
  catch{ return []; }
}
function setList(l){ localStorage.setItem(STORAGE_KEY, JSON.stringify(l)); }

function getLead(){
  try{
    const a = localStorage.getItem(LEAD_KEY_MAIN);
    if(a) return JSON.parse(a);
  }catch(_){}
  try{
    const b = localStorage.getItem(LEAD_KEY_FALLBACK);
    if(b) return JSON.parse(b);
  }catch(_){}
  return null;
}

function upsertCheckbox(name, checked, type){
  let l = getList().filter(x => x.pergunta !== name);
  if(checked){
    l.push({ pergunta:name, alternativa:type });
  }
  setList(l);
}

function countSelected(){
  return document.querySelectorAll('#formP4 input[type="checkbox"]:checked').length;
}

/* ================= BUILD ================= */
function build(){
  const grid = document.getElementById("gridWords");
  grid.innerHTML = palavras.map((obj,i)=>{
    const n = String(i+1).padStart(2,"0");
    return `
      <div class="word" data-type="${obj.type}">
        <span><small>${i+1}.</small> ${obj.label}</span>
        <input type="checkbox" name="P4_${n}">
      </div>
    `;
  }).join("");

  grid.querySelectorAll(".word").forEach(card=>{
    const cb = card.querySelector("input");
    const type = card.getAttribute("data-type");

    card.addEventListener("click", e=>{
      if(e.target === cb) return;
      cb.checked = !cb.checked;
      card.classList.toggle("selected", cb.checked);
      upsertCheckbox(cb.name, cb.checked, type);
    });

    cb.addEventListener("change",()=>{
      card.classList.toggle("selected", cb.checked);
      upsertCheckbox(cb.name, cb.checked, type);
    });
  });
}

function restore(){
  getList().forEach(r=>{
    if(!r.pergunta.startsWith("P4_")) return;
    const cb = document.querySelector(`input[name="${r.pergunta}"]`);
    if(cb){
      cb.checked = true;
      cb.closest(".word").classList.add("selected");
    }
  });
}

/* ================= INIT ================= */
document.addEventListener("DOMContentLoaded",()=>{
  if(!getLead()){
    window.location.href = "../index.html";
    return;
  }

  build();
  restore();

  document.getElementById("btnFinish").addEventListener("click", ()=>{
    if(countSelected() < MIN){
      alert("Selecione pelo menos " + MIN + " opções.");
      return;
    }
    window.location.href = "../resultado.html";
  });
});
</script>

</body>
</html>
